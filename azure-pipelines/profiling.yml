trigger: none
pr: none
schedules:
- cron: '18 1 * * *' # every day at 1:18 AM
  displayName: Periodic profiling run
  branches:
    include:
    - main

variables:
- name: TRACE_DROP_LOCATION
  value: $(Build.SourcesDirectory)/out/profiling/
- name: MERGED_TRACE_LOCATION
  value: $(Build.SourcesDirectory)/out/profiling/merged/
- name: LOGS_DIRECTORY
  value: $(Build.SourcesDirectory)/out/logs/
- template: /azure-pipelines/dotnet-variables.yml@self


resources:
  repositories:
  - repository: 1ESPipelineTemplates
    type: git
    name: 1ESPipelineTemplates/1ESPipelineTemplates
    ref: refs/tags/release
extends:
  template: v1/1ES.Official.PipelineTemplate.yml@1ESPipelineTemplates
  parameters:
    pool:
      name: AzurePipelines-EO
      image: 1ESPT-Ubuntu20.04
      os: Linux
    stages:
    - stage: run
      jobs:
      - job: run
        templateContext:
          outputs:
          - output: pipelineArtifact
            targetPath: $(TRACE_DROP_LOCATION)
            artifactName: traces
            displayName: ðŸ“¢ Publish intermediate trace files
            condition: failed()
          - output: pipelineArtifact
            targetPath: $(MERGED_TRACE_LOCATION)
            artifactName: merged mibc
            displayName: ðŸ“¢ Publish merged MIBC
        steps:
        - checkout: self
          clean: true
          fetchTags: false

        - template: test.yml
          parameters:
            dotnetVersion: $(defaultDotnetVersion)
            npmCommand: profiling
            testVSCodeVersion: stable